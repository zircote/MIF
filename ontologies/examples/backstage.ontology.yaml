---
# Backstage.io Software Catalog Ontology
#
# A comprehensive ontology modeling Backstage.io's Software Catalog
# entity model for developer portals and service catalogs.
#
# Compatible with: mif-base v1.0.0, shared-traits v1.0.0
#
# Version: 1.0.0
# Last Updated: 2026-01-26
#
# Sources:
# - Backstage System Model
#   https://backstage.io/docs/features/software-catalog/system-model
# - Backstage Descriptor Format
#   https://backstage.io/docs/features/software-catalog/descriptor-format
# - Backstage Well-Known Annotations
#   https://backstage.io/docs/features/software-catalog/well-known-annotations
# - Backstage Well-Known Relations
#   https://backstage.io/docs/features/software-catalog/well-known-relations
# - CNCF Backstage Project
#   https://www.cncf.io/projects/backstage/

ontology:
  id: backstage
  version: "1.0.0"
  description: "Backstage.io software catalog ontology"
  schema_url: "https://raw.githubusercontent.com/zircote/MIF/main/schema/ontology.schema.json"
  extends:
    - mif-base
    - shared-traits

# ===========================================================================
# CUSTOM NAMESPACES
# ===========================================================================

namespaces:
  semantic:
    children:
      # Core Catalog Entities
      components:
        description: "Software components, services, libraries, websites"
        type_hint: semantic
      apis:
        description: "API definitions and interfaces"
        type_hint: semantic
      resources:
        description: "Infrastructure and external resources"
        type_hint: semantic
      systems:
        description: "Collections of components forming products"
        type_hint: semantic
      domains:
        description: "Business or product area groupings"
        type_hint: semantic

      # Organizational Entities
      groups:
        description: "Teams, business units, organizational groups"
        type_hint: semantic
      users:
        description: "Individual people and service accounts"
        type_hint: semantic
      locations:
        description: "Catalog file locations and references"
        type_hint: semantic

      # Extensibility
      templates:
        description: "Software templates for scaffolding"
        type_hint: semantic

  episodic:
    children:
      catalog-events:
        description: "Catalog changes, entity updates"
        type_hint: episodic
      deployments:
        description: "Deployment and release events"
        type_hint: episodic
      incidents:
        description: "Service incidents and outages"
        type_hint: episodic

  procedural:
    children:
      scaffolding:
        description: "Template scaffolding procedures"
        type_hint: procedural
      onboarding:
        description: "Service onboarding workflows"
        type_hint: procedural
      docs-publishing:
        description: "TechDocs publishing procedures"
        type_hint: procedural

# ===========================================================================
# ENTITY TYPES
# ===========================================================================

entity_types:
  # -------------------------------------------------------------------------
  # CORE SOFTWARE ENTITIES
  # -------------------------------------------------------------------------
  - name: component
    description: "A software component (service, website, library, etc.)"
    base: semantic
    traits:
      - lifecycle
      - owned
      - tagged
      - documented
    schema:
      required:
        - name
        - type
        - lifecycle
        - owner
      properties:
        name:
          type: string
          description: "Component name (kebab-case)"
          pattern: "^[a-z0-9]+(-[a-z0-9]+)*$"
        type:
          type: string
          description: "Component type"
          enum:
            - service
            - website
            - library
            - documentation
            - template
            - other
        lifecycle:
          type: string
          description: "Development lifecycle stage"
          enum:
            - experimental
            - development
            - production
            - deprecated
        owner:
          type: string
          description: "Owning group reference"
        system:
          type: string
          description: "Parent system reference"
        subcomponent_of:
          type: string
          description: "Parent component for nested components"
        provides_apis:
          type: array
          description: "APIs provided by this component"
          items:
            type: string
        consumes_apis:
          type: array
          description: "APIs consumed by this component"
          items:
            type: string
        depends_on:
          type: array
          description: "Components and resources this depends on"
          items:
            type: string

  - name: api
    description: "An API interface definition"
    base: semantic
    traits:
      - lifecycle
      - owned
      - versioned
    schema:
      required:
        - name
        - type
        - lifecycle
        - owner
        - definition
      properties:
        name:
          type: string
          description: "API name"
        type:
          type: string
          description: "API specification type"
          enum:
            - openapi
            - asyncapi
            - graphql
            - grpc
            - trpc
        lifecycle:
          type: string
          enum:
            - experimental
            - development
            - production
            - deprecated
        owner:
          type: string
        system:
          type: string
        definition:
          type: string
          description: "API definition (inline or $text reference)"

  - name: resource
    description: "Infrastructure or external resource"
    base: semantic
    traits:
      - lifecycle
      - owned
    schema:
      required:
        - name
        - type
        - owner
      properties:
        name:
          type: string
        type:
          type: string
          description: "Resource type"
          enum:
            - database
            - s3-bucket
            - cdn
            - cluster
            - queue
            - cache
            - storage
            - artifact-registry
            - secret-store
            - vault
            - other
        owner:
          type: string
        system:
          type: string
        depends_on:
          type: array
          items:
            type: string

  # -------------------------------------------------------------------------
  # ORGANIZATIONAL ENTITIES
  # -------------------------------------------------------------------------
  - name: system
    description: "A collection of components forming a product/capability"
    base: semantic
    traits:
      - owned
      - tagged
    schema:
      required:
        - name
        - owner
      properties:
        name:
          type: string
        owner:
          type: string
        domain:
          type: string
          description: "Parent domain reference"

  - name: domain
    description: "A business or product area grouping systems"
    base: semantic
    traits:
      - owned
    schema:
      required:
        - name
        - owner
      properties:
        name:
          type: string
        owner:
          type: string

  - name: group
    description: "A team, business unit, or organizational group"
    base: semantic
    traits:
      - contactable
    schema:
      required:
        - name
        - type
      properties:
        name:
          type: string
        type:
          type: string
          description: "Group type"
          enum:
            - team
            - business-unit
            - product-area
            - organization
            - sub-department
        parent:
          type: string
          description: "Parent group reference"
        children:
          type: array
          description: "Child group references"
          items:
            type: string
        members:
          type: array
          description: "User references"
          items:
            type: string
        profile:
          type: object
          properties:
            display_name:
              type: string
            email:
              type: string
              format: email
            picture:
              type: string
              format: uri
            slack:
              type: string
            pagerduty:
              type: string

  - name: user
    description: "An individual person or service account"
    base: semantic
    traits:
      - contactable
    schema:
      required:
        - name
      properties:
        name:
          type: string
          description: "Username (typically email prefix)"
        member_of:
          type: array
          description: "Group memberships"
          items:
            type: string
        profile:
          type: object
          properties:
            display_name:
              type: string
            email:
              type: string
              format: email
            picture:
              type: string
              format: uri
            github:
              type: string
            slack:
              type: string
            pagerduty:
              type: string

  - name: location
    description: "A reference to catalog file locations"
    base: semantic
    schema:
      required:
        - name
        - type
        - target
      properties:
        name:
          type: string
        type:
          type: string
          description: "Location type"
          enum:
            - url
            - file
            - github
            - gitlab
            - bitbucket
            - azure-devops
        target:
          type: string
          description: "Target URL or path"
        presence:
          type: string
          description: "Whether location is required"
          enum:
            - required
            - optional

  # -------------------------------------------------------------------------
  # EXTENSIBILITY ENTITIES
  # -------------------------------------------------------------------------
  - name: template
    description: "A software template for scaffolding new projects"
    base: procedural
    traits:
      - versioned
      - owned
      - tagged
    schema:
      required:
        - name
        - type
        - owner
      properties:
        name:
          type: string
        type:
          type: string
          enum:
            - service
            - website
            - documentation
            - library
            - other
        owner:
          type: string
        parameters:
          type: array
          description: "Template input parameters"
          items:
            type: object
            properties:
              name:
                type: string
              title:
                type: string
              description:
                type: string
              type:
                type: string
              required:
                type: boolean
              default:
                type: string
        steps:
          type: array
          description: "Scaffolding steps"
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              action:
                type: string

  # -------------------------------------------------------------------------
  # CATALOG ANNOTATIONS & METADATA
  # -------------------------------------------------------------------------
  - name: annotation
    description: "Well-known catalog annotation"
    base: semantic
    schema:
      required:
        - key
        - description
      properties:
        key:
          type: string
          description: "Annotation key (domain/name format)"
        description:
          type: string
        value_type:
          type: string
          enum:
            - string
            - url
            - json
        example:
          type: string

  # -------------------------------------------------------------------------
  # OPERATIONAL ENTITIES
  # -------------------------------------------------------------------------
  - name: catalog-refresh
    description: "Catalog refresh/sync event"
    base: episodic
    schema:
      required:
        - location_id
        - timestamp
        - status
      properties:
        location_id:
          type: string
        timestamp:
          type: string
          format: date-time
        status:
          type: string
          enum:
            - success
            - partial
            - failed
        entities_processed:
          type: integer
        errors:
          type: array
          items:
            type: string

  - name: techdocs-build
    description: "TechDocs build event"
    base: episodic
    schema:
      required:
        - entity_ref
        - timestamp
        - status
      properties:
        entity_ref:
          type: string
          description: "Entity reference (kind:namespace/name)"
        timestamp:
          type: string
          format: date-time
        status:
          type: string
          enum:
            - success
            - failed
        build_duration_seconds:
          type: number
        output_url:
          type: string
          format: uri

  - name: scaffolder-task
    description: "Template scaffolding task execution"
    base: episodic
    traits:
      - lifecycle
    schema:
      required:
        - template_ref
        - created_by
        - status
      properties:
        template_ref:
          type: string
        created_by:
          type: string
        status:
          type: string
          enum:
            - pending
            - running
            - completed
            - failed
            - cancelled
        parameters:
          type: object
        output:
          type: object
          properties:
            repo_url:
              type: string
            catalog_entity:
              type: string

# ===========================================================================
# TRAITS
# ===========================================================================

traits:
  documented:
    description: "Adds TechDocs and documentation fields"
    fields:
      techdocs_ref:
        type: string
        description: "TechDocs entity reference"
      docs_url:
        type: string
        format: uri
        description: "External documentation URL"

# ===========================================================================
# RELATIONSHIPS
# ===========================================================================

relationships:
  owned_by:
    description: "Entity is owned by a group"
    from:
      - component
      - api
      - resource
      - system
      - domain
      - template
    to:
      - group
    symmetric: false

  part_of:
    description: "Entity is part of a system/domain"
    from:
      - component
      - api
      - resource
    to:
      - system
    symmetric: false

  has_part:
    description: "System has component parts"
    from:
      - system
    to:
      - component
      - api
      - resource
    symmetric: false

  member_of:
    description: "User is member of group"
    from:
      - user
    to:
      - group
    symmetric: false

  has_member:
    description: "Group has user members"
    from:
      - group
    to:
      - user
    symmetric: false

  parent_of:
    description: "Parent group relationship"
    from:
      - group
    to:
      - group
    symmetric: false

  child_of:
    description: "Child group relationship"
    from:
      - group
    to:
      - group
    symmetric: false

  provides_api:
    description: "Component provides an API"
    from:
      - component
    to:
      - api
    symmetric: false

  consumes_api:
    description: "Component consumes an API"
    from:
      - component
    to:
      - api
    symmetric: false

  depends_on:
    description: "Component depends on resource or component"
    from:
      - component
      - resource
    to:
      - component
      - resource
    symmetric: false

  dependency_of:
    description: "Resource is a dependency of component"
    from:
      - resource
      - component
    to:
      - component
    symmetric: false

# ===========================================================================
# DISCOVERY PATTERNS
# ===========================================================================

discovery:
  enabled: true
  confidence_threshold: 0.8

  patterns:
    # Component patterns
    - content_pattern: "\\b(service|microservice|backend|frontend)\\b"
      suggest_entity: component
      suggest_namespace: _semantic/components
    - content_pattern: "\\b(library|package|module|sdk)\\b"
      suggest_entity: component
      suggest_namespace: _semantic/components
    - content_pattern: "\\b(website|web app|portal|dashboard)\\b"
      suggest_entity: component
      suggest_namespace: _semantic/components
    - file_pattern: "**/catalog-info.yaml"
      suggest_entity: component
      suggest_namespace: _semantic/components

    # API patterns
    - content_pattern: "\\b(openapi|swagger|graphql|grpc|rest api)\\b"
      suggest_entity: api
      suggest_namespace: _semantic/apis
    - content_pattern: "\\b(asyncapi|websocket|event-driven)\\b"
      suggest_entity: api
      suggest_namespace: _semantic/apis
    - file_pattern: "**/openapi.yaml"
      suggest_entity: api
      suggest_namespace: _semantic/apis
    - file_pattern: "**/schema.graphql"
      suggest_entity: api
      suggest_namespace: _semantic/apis

    # Resource patterns
    - content_pattern: "\\b(database|postgres|mysql|mongodb|redis)\\b"
      suggest_entity: resource
      suggest_namespace: _semantic/resources
    - content_pattern: "\\b(s3|bucket|storage|cdn|cloudfront)\\b"
      suggest_entity: resource
      suggest_namespace: _semantic/resources
    - content_pattern: "\\b(kafka|rabbitmq|sqs|queue|pubsub)\\b"
      suggest_entity: resource
      suggest_namespace: _semantic/resources
    - content_pattern: "\\b(kubernetes|k8s|cluster|namespace)\\b"
      suggest_entity: resource
      suggest_namespace: _semantic/resources

    # System/Domain patterns
    - content_pattern: "\\b(system|platform|product)\\b"
      suggest_entity: system
      suggest_namespace: _semantic/systems
    - content_pattern: "\\b(domain|business unit|capability)\\b"
      suggest_entity: domain
      suggest_namespace: _semantic/domains

    # Group patterns
    - content_pattern: "\\b(team|squad|tribe|guild)\\b"
      suggest_entity: group
      suggest_namespace: _semantic/groups

    # Template patterns
    - content_pattern: "\\b(template|scaffold|cookiecutter)\\b"
      suggest_entity: template
      suggest_namespace: _semantic/templates
    - file_pattern: "**/template.yaml"
      suggest_entity: template
      suggest_namespace: _semantic/templates

    # TechDocs patterns
    - content_pattern: "\\b(techdocs|mkdocs|documentation site)\\b"
      suggest_entity: techdocs-build
      suggest_namespace: _episodic/catalog-events
    - file_pattern: "**/mkdocs.yml"
      suggest_entity: component
      suggest_namespace: _semantic/components
